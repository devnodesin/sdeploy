# SDeploy - Full Configuration Reference
# Copy to /etc/sdeploy.conf or ./sdeploy.conf
# All supported fields with descriptions

# ------------------------------------------------------------------------------
# Global Settings
# ------------------------------------------------------------------------------

# HTTP port for webhook listener (default: 8080)
listen_port: 8080

# Path to log file (default: /var/log/sdeploy.log)
# Logs are written to this file in append mode
log_filepath: /var/log/sdeploy.log

# ------------------------------------------------------------------------------
# Email Notifications (optional)
# If omitted or incomplete, email notifications are disabled globally
# ------------------------------------------------------------------------------

email_config:
  # SMTP server hostname
  smtp_host: smtp.example.com
  # SMTP server port (587 for TLS, 465 for SSL)
  smtp_port: 587
  # SMTP authentication username
  smtp_user: user@example.com
  # SMTP authentication password or API key
  smtp_pass: your_smtp_password
  # Sender email address for notifications
  email_sender: sdeploy@example.com

# ------------------------------------------------------------------------------
# Projects
# Define one or more projects to deploy via webhooks
# ------------------------------------------------------------------------------

projects:
  # --- Project 1: Full example with all fields ---
  - # Human-readable project name (for logging)
    name: Frontend App

    # Unique webhook endpoint path (required)
    webhook_path: /hooks/frontend

    # Secret for webhook authentication (required)
    # Used for HMAC signature validation or ?secret= query param
    webhook_secret: frontend_secret_token

    # Git repository URL (optional)
    # If omitted, no git clone/pull is performed
    git_repo: https://github.com/myorg/frontend-app.git

    # Git branch to deploy (default: main)
    git_branch: main

    # Run git pull before deployment (default: false)
    git_update: true

    # Local directory for git operations (required if git_repo is set)
    local_path: /var/repo/frontend

    # Working directory for execute_command (default: local_path)
    execute_path: /var/www/frontend

    # Shell command to run for deployment (required)
    execute_command: npm install && npm run build

    # Command timeout in seconds (optional, 0 = no timeout)
    timeout_seconds: 600

    # Email recipients for deployment notifications (optional)
    # If omitted or empty, no emails sent for this project
    email_recipients:
      - frontend-team@example.com
      - devops@example.com

  # --- Project 2: Private repository with SSH key ---
  - name: Private Backend API
    webhook_path: /hooks/backend-api
    webhook_secret: backend_secret_token

    # Private repository using SSH URL
    git_repo: git@github.com:myorg/private-backend.git

    # SSH private key for git authentication (optional)
    # Path to SSH private key file for accessing private repositories
    # Key file should have 0600 permissions (chmod 600 /path/to/key)
    # If omitted, uses default SSH agent (for public repos or user SSH config)
    git_ssh_key_path: /etc/sdeploy/keys/backend-deploy-key

    git_branch: main
    git_update: true
    local_path: /var/repo/backend
    execute_path: /var/www/backend
    execute_command: npm install && npm run build
    timeout_seconds: 300
    email_recipients:
      - backend-team@example.com

  # --- Project 3: Minimal example (local script, no git) ---
  - name: Local Deploy Script
    webhook_path: /hooks/local-deploy
    webhook_secret: local_secret_123
    local_path: /opt/scripts
    execute_command: sh /opt/scripts/deploy.sh
